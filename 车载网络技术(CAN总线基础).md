# 车载网络技术(CAN总线基础)

## 概述

车联网可分为车内网，车际网和车云网，同样可分为低速，中速，高速

**为什么用数据总线？**

- 减少线束，将原有的点对点连接改为每个ECU连接到总线BUS上
- 电子信息代替机械传动，例如线控转向，线控刹车等。实现汽车机械化向电气化转型



**主要车载网络的协议情况**

|  名称   |             概要              |    最大速度     |    推动单位     |
| :-----: | :---------------------------: | :-------------: | :-------------: |
|   CAN   |    车身/控制系统用LAN协议     |     1Mbit/s     | Bosch ISO 11898 |
|   LIN   |       车身控制用LAN协议       |    20Kbit/s     |    LIN协议会    |
| FlexRay | 重视安全，按用途分类的LAN协议 | 10M or 20Mbit/s |       BWM       |
|  MOST   |         信息通讯协议          |   22.5Mbit/s    |  MOST合作组织   |
|  IDB-C  |     以CAN为基础的LAN协议      |    250Kbit/s    |     IDM论坛     |

主要讲解CAN



**现场总线**：双向、串行、多节点、开放。连接并通信。

特点与要求：实时性强，可靠性高，安全性好。多维短帧传输，速率较低。



**车用总线**：线路简单，系统一体化，范围小，节点数少，要求的传输速度不高。

​					优点：减少线束，电子信息传输，改善了车辆灵活性，改善车辆性能，数据共享，车辆整体化。

**总线**

按拓扑结构划分：星型网，总线网、环形网

按传输介质划分：双绞线，同轴电缆，光纤

按通信方式划分：单工通信，半双工通信，全双工通信





## CAN总线

### 概述

**车载网络要求**：

- 采用串行总线拓扑
- 节点可以动态改变(指节点数目)
- 抗干扰能力
- 差错检测和处理
- 实时性需求
- 具备故障诊断和处理能力
- 成本较低



**CAN特点**：

- ISO 11898标准
- 双线差分信号
- 对节点数无限制动态改变
- 广播发送支持，可以实现一对多的消息发送
- 多主站结构，各节点是平等的
- 优先级、相关性过滤，两者依赖于ID
- 短帧结构
- 通信介质灵活，为双绞线
- 节点价格较低
- 开发技术简单
- 系统数据一致性好



### 物理层

**什么是CAN总线？**

CAN是一个网络协议，意味着数据怎样传输

CAN的节点结构

![image-20230201091514762](车载网络技术(CAN总线基础).assets/image-20230201091514762.png)

**拓扑结构**

|   名称   | 最小值min |     最大值max      |
| :------: | :-------: | :----------------: |
|  总线长  |     0     |        40m         |
|  支线长  |     0     |         1m         |
|  节点距  |   0.1m    |        40m         |
| 终端电阻 |   100Ω    | 130Ω，名义值为120Ω |



**双绞线**

分为屏蔽式双绞线和非屏蔽室双绞线

|     名称      | 最小值 | 名义值 | 最大值 |
| :-----------: | :----: | :----: | :----: |
| 特征电阻$Z_0$ |  95Ω   |  120Ω  |  140Ω  |
|   单位电阻    | 70mΩ/m | 70mΩ/m | 70mΩ/m |
|   单位延迟    | 5ns/m  | 5ns/m  | 5ns/m  |

采用双绞线的优点：

与散线相比，特征阻抗稳定

与平行线相比，机械强度较好

与同轴电缆相比，成本较低



1、双绞线的单位延迟计算

2、计算双绞线的特征阻抗

​	特征阻抗影响因素：导线截面积，屏蔽层，绞率，频率

**终端电阻**：避免终端反射的发生，需要避免地漂

反射率的计算



**CAN接口**

![image-20230201093313728](车载网络技术(CAN总线基础).assets/image-20230201093313728.png)



### 数据链路层

**CAN数据**

- 通信机制

  1、发送报文

  ​		1） 检测BUS状态

  ​		2） 发送报文，且回读

  ​		3） 线与机制：同时发报文，如0001中显性为将1000覆盖掉了

  2、报文的接受

  ​		根据ID进行相关性过滤，采用NRZ编码，报文紧凑；曼彻斯特编码能够实现位同步

  ​		NRZ与位填充，NRZ编码沿少，定时不同步，需要进行位填充

  ​		CAN**发**连续5个相同为，补一个极性相反位

  ​			    **收**连续5个相同为，去一个极性相反位

  - 线与
  - 优先级
  - 相关性

- CAN帧类型

  - **数据**
    - 标准帧
    - 拓展帧
  - 远程
  - **错误**
  - 超载
  - 帧间空间

- **错误检测与处理**

  - 画图

- 位定时与同步

  - 硬同步
  - 重同步

- CAN控制器

## CANFD



## J1939

### 概述

### 物理层

### 数据链路层

